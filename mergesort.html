<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Merge Sort - VisualAlgo</title>
    <meta
      content="VisualAlgo is an online algorithm visualization tool."
      name="description"
    />
    <meta content="algorithm visualization tool online" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/icofont/icofont.min.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/venobox/venobox.css" rel="stylesheet" />
    <link
      href="assets/vendor/owl.carousel/assets/owl.carousel.min.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css"
    />
    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
  </head>

  <body>

    <!-- ======= Header ======= -->
    <header id="header" class="fixed-top header-inner-pages">
      <div class="container-fluid d-flex align-items-center">
        <a class="btn back-button mr-4" href="sorting.html"
          ><i class="bx bx-arrow-back white-text" aria-hidden="true"></i>
          Back</a
        >
        <h1 class="logo mr-auto"><a href="index.html">VisualAlgo</a></h1>
        <!-- Uncomment below if you prefer to use an image logo -->
        <!-- <a href="index.html" class="logo mr-auto"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

        <nav class="nav-menu d-none d-lg-block">
          <ul>
            <li><a href="index.html">Home</a></li>
          </ul>
        </nav>
        <!-- .nav-menu -->
      </div>
    </header>
    <!-- End Header -->

    <main id="main">
      <!-- ======= Breadcrumbs ======= -->
      <section id="breadcrumbs" class="breadcrumbs">
        <div class="container-fluid">
          <ol>
            <li><a href="index.html">Home</a></li>
            <li><a href="sorting.html">Sorting</a></li>
            <li>Merge Sort</li>
          </ol>
          <h2>Merge Sort visualization</h2>
        </div>
      </section>
      <!-- End Breadcrumbs -->

      <section class="inner-page pt-4">
        <div class="container-fluid px-0 mt-2">
          <div class="">
            <span class="row mx-auto px-0 w-100"
              ><span class="font-weight-bold ml-2 mt-2 mb-2 compSpan"
                >No. of comparisons: 0 </span
              ><span class="font-weight-bold ml-2 mt-2 mb-2 swapSpan"
                >No. of array accesses: 0
              </span></span
            >
            <div class="data-container p-1 mb-0 mt-0 w-100">
              <svg id="visu"></svg>
            </div>
          </div>
          <div class="row mx-auto">
            <div class="col-sm-12 col-md-12 col-lg-6 px-0 mr-0">
              <div class="ide w-100">
                <div class="row ml-auto mr-auto 1">
                  <span><span class="op">function</span> merge(left, mid, right)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 2">
                  <span>&emsp;&emsp;leftSize = mid - left + 1</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 3">
                  <span>&emsp;&emsp;rightSize = right - mid</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 4">
                  <span>&emsp;&emsp;leftArray = new Array(leftSize)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 5">
                  <span>&emsp;&emsp;rightArray = new Array(rightSize)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 6">
                  <span>&emsp;&emsp;<span class="op">for</span> (i = 0; i < leftSize; i++)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 7">
                  <span>&emsp;&emsp;&emsp;&emsp;leftArray[i] = list[left + i]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 8">
                  <span>&emsp;&emsp;<span class="op">for</span> (j = 0; j < rightSize; j++)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 9">
                  <span>&emsp;&emsp;&emsp;&emsp;rightArray[j] = list[mid + 1 + j]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 10">
                  <span>&emsp;&emsp;i = 0, j = 0, k = left</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 11">
                  <span>&emsp;&emsp;<span class="op">while</span> (i < leftSize && j < rightSize)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 12">
                  <span>&emsp;&emsp;&emsp;&emsp;<span class="op">if</span> (leftArray[i] <= rightArray[j])</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 13">
                  <span>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;list[k++] = leftArray[i++]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 14">
                  <span>&emsp;&emsp;&emsp;&emsp;<span class="op">else</span></span>
                </div>
                <div class="row ml-auto mr-auto mt-1 15">
                  <span>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;list[k++] = rightArray[j++]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 16">
                  <span>&emsp;&emsp;<span class="op">while</span> (i < leftSize)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 17">
                  <span>&emsp;&emsp;&emsp;&emsp;list[k++] = leftArray[i++]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 18">
                  <span>&emsp;&emsp;<span class="op">while</span> (j < rightSize)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 19">
                  <span>&emsp;&emsp;&emsp;&emsp;list[k++] = rightArray[j++]</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span>&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto 20">
                  <span><span class="op">function</span> mergeSort(left, right)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 21">
                  <span>&emsp;&emsp;<span class="op">if</span> (left < right)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 22">
                  <span>&emsp;&emsp;&emsp;&emsp;mid = Math.floor((left + right) / 2)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 23">
                  <span>&emsp;&emsp;&emsp;&emsp;<span class="op">mergeSort</span>(left, mid)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 24">
                  <span>&emsp;&emsp;&emsp;&emsp;<span class="op">mergeSort</span>(mid + 1, right)</span>
                </div>
                <div class="row ml-auto mr-auto mt-1 25">
                  <span>&emsp;&emsp;&emsp;&emsp;<span class="op">merge</span>(left, mid, right)</span>
                </div>
              </div>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-6 ml-0 px-0">
              <div class="ide w-100 pl-0">
                <div class="row ml-auto mr-auto">
                  <span><span class="comment">&emsp;</span></span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment text-center">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">---------------------</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">| SHORT EXPLANATION |</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">---------------------</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    1. Divide the array into two halves.
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    2. Recursively sort each half.
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    3. Merge the sorted halves:
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    - Create temporary arrays for left and right halves
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    - Compare elements from both arrays and merge in order
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment">
                    - Copy any remaining elements from either array
                  </span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment w-100">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment text-center w-100">&emsp;</span>
                </div>
                <div class="row ml-auto mr-auto mt-1">
                  <span class="comment text-center w-100">&emsp;</span>
                </div>
              </div>
            </div>
          </div>
          <hr data-content="Settings" class="hr-text mb-3 mt-4" />
          <div class="row mx-auto">
            <div class="col-sm-12 col-md-12 col-lg-6">
              <form>
                <div class="form-group row">
                  <div class="col-sm-3">Elements:</div>
                  <div class="col-sm-9 disableSlider">
                    <span>5&emsp;</span>
                    <input
                      id="slider"
                      data-slider-id="pointsSlider"
                      type="text"
                      data-slider-min="5"
                      data-slider-max="50"
                      data-slider-step="1"
                      data-slider-value="15"
                    />
                    <span id="max">&emsp;50</span>
                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-3">Data Generation</div>
                  <div class="col-sm-9">
                    <div class="form-check">
                      <input
                        id="own-data"
                        class="form-check-input"
                        type="checkbox"
                        id="gridCheck1"
                      />
                      <label class="form-check-label" for="gridCheck1">
                        Use own data
                      </label>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="col-sm-12 col-md-12 col-lg-6">
              <form>
                <div class="form-group row">
                  <div class="col-sm-5">Speed:</div>
                  <div class="col-sm-7">
                    <span>Slow&emsp;</span>
                    <input
                      id="speedslider"
                      data-slider-id="speedSlider"
                      type="text"
                      data-slider-min="10"
                      data-slider-max="1000"
                      data-slider-step="10"
                      data-slider-value="200"
                    />
                    <span>&emsp;Fast</span>
                  </div>
                </div>
                <div class="form-group row">
                  <label for="data-input" class="col-sm-5 col-form-label"
                    >Your data (max. 50 elements):</label
                  >
                  <div class="col-sm-7">
                    <input
                      disabled="true"
                      type="text"
                      class="form-control"
                      id="data-input"
                      placeholder="10,42,34,55,..."
                    />
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="row mx-auto">
            <div class="col-4"></div>
            <div class="col-4">
              <button
                id="sort-button"
                type="button"
                onclick="runMergeSort()"
                class="btn btn-danger red w-100"
              >
                Sort
              </button>
            </div>
            <div class="col-4"></div>
          </div>
        </div>
      </section>
    </main>


    <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>
    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/jquery/jquery.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/venobox/venobox.min.js"></script>
    <script src="assets/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"></script>
    <script src="https://d3js.org/d3.v5.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

    <script>
      $(document).ready(function () {
        d3.select("#visu")
          .attr("width", "100%")
          .attr("height", "370")
          .attr("viewBox", "0 0 " + globalThis.screen.availWidth + " 370");
        var slider = new Slider("#slider", {
          handle: "square",
        });

        slider.on("slide", function (slideEvt) {
          newSet(slideEvt);
        });

        $("#data-input").on("input", function (e) {
          ownData(this.value);
        });

        $("#own-data").change(function () {
          if (this.checked) {
            slider.disable();
            $("#data-input").prop("disabled", false);
          } else {
            slider.enable();
            $("#data-input").prop("disabled", true);
          }
        });

        var speedSlider = new Slider("#speedslider", {
          reversed: true,
          tooltip: "none",
          handle: "square",
        });

        speedSlider.on("slide", function (slideEvt) {
          setDelay(slideEvt);
        });

        if (globalThis.screen.availWidth <= 360) {
          slider.setAttribute("max", "20");
          slider.setAttribute("value", "15");
          $("#max").html("&emsp;20");
        }
      });
    </script>

    <script>
      const container = document.querySelector(".data-container");
      var FLAG = false;
      var DELAY = 200;
      var w = globalThis.screen.availWidth;
      var h = 370;
      var barPadding = 5;
      var data = [];
      var x;
      var svg = d3.select("#visu");
      var comparisons = 0;
      var arrayAccesses = 0;
      var auxArray = [];

      function setDelay(delay) {
        DELAY = delay;
      }

      function clamp(number, min, max) {
        return Math.max(min, Math.min(number, max));
      }

      function newSet(num = 20) {
        data = [];

        for (let i = 0; i < num; i++) {
          data.push(Math.floor(Math.random() * 119) + 1);
        }

        clearBlocks();
        generateBlocks(data);
      }

      function stop() {
        FLAG = true;
      }

      function ownData(d = "1,2,3,4,5,6") {
        data = d.split(",");
        if (data.length > 50) {
          data = data.slice(0, 50);
        }
        for (let i = 0; i < data.length; i++) {
          data[i] = parseInt(data[i]);
          data[i] = clamp(data[i], 0, 119);
        }
        clearBlocks();
        generateBlocks(data);
      }

      // Update a specific bar in the visualization
      async function updateBar(index, value, color = "#CC1616") {
        return new Promise((resolve) => {
          arrayAccesses++;
          $(".swapSpan").html(`No. of array accesses: ${arrayAccesses}`);

          d3.select("#rect" + index)
            .transition()
            .duration(DELAY / 2)
            .attr("y", h - value * 3)
            .attr("height", value * 3)
            .attr("fill", color);

          d3.select("#text" + index)
            .transition()
            .duration(DELAY / 2)
            .text(value)
            .attr("y", h - value * 3 - 5);

          setTimeout(() => {
            resolve();
          }, DELAY);
        });
      }

      function clearBlocks() {
        svg.selectAll("rect").data([]).exit().remove();
        svg.selectAll("text").data([]).exit().remove();
      }

      function generateBlocks(data) {
        x = d3.scaleLinear().domain([0, data.length]).range([0, w]);
        var bars = svg
          .selectAll("rect")
          .data(data)
          .enter()
          .append("rect")
          .attr("transform", function (d, i) {
            return "translate(" + x(i) + ",0)";
          })
          .attr("y", function (d) {
            return h - d * 3;
          })
          .attr("width", w / data.length - barPadding)
          .attr("height", function (d) {
            return d * 3;
          })
          .attr("fill", "#CC1616")
          .attr("id", function (d, i) {
            return "rect" + i;
          });

        var labels = svg
          .selectAll("text")
          .data(data)
          .enter()
          .append("text")
          .text(function (d) {
            return d;
          })
          .attr("transform", function (d, i) {
            return "translate(" + (x(i) + w / data.length / 2) + ",0)";
          })
          .attr("y", function (d) {
            return h - d * 3 - 5;
          })
          .attr("font-family", "sans-serif")
          .attr("font-size", "14px")
          .attr("fill", "black")
          .attr("text-anchor", "middle")
          .attr("id", function (d, i) {
            return "text" + i;
          });
      }

      function highlightCode(elementClass) {
        $(".code-highlight").removeClass("code-highlight");
        $(`.${elementClass}`).addClass("code-highlight");
      }

      async function runMergeSort() {
        $("#sort-button, #data-input").prop("disabled", true);
        $(".disableSlider").prop("hidden", true);
        comparisons = 0;
        arrayAccesses = 0;
        auxArray = new Array(data.length);
        await mergeSort(0, data.length - 1);
        
        // Final visualization with all bars in sorted state
        for (let i = 0; i < data.length; i++) {
          d3.select("#rect" + i).attr("fill", "#171717");
        }
        
        $("#sort-button, #data-input").prop("disabled", false);
        $(".disableSlider").prop("hidden", false);
      }

      async function merge(left, mid, right) {
        highlightCode("1");
        await new Promise((resolve) => setTimeout(resolve, DELAY));
        
        highlightCode("2");
        const leftSize = mid - left + 1;
        highlightCode("3");
        const rightSize = right - mid;
        
        highlightCode("4");
        const leftArray = new Array(leftSize);
        highlightCode("5");
        const rightArray = new Array(rightSize);
        
        // Color the subarrays being merged
        for (let i = left; i <= right; i++) {
          if (i <= mid) {
            d3.select("#rect" + i).attr("fill", "#9DBDC6");  // Left subarray
          } else {
            d3.select("#rect" + i).attr("fill", "#1764B3");  // Right subarray
          }
        }
        
        await new Promise((resolve) => setTimeout(resolve, DELAY));
        
        // Copy data to temp arrays
        highlightCode("6");
        for (let i = 0; i < leftSize; i++) {
          highlightCode("7");
          leftArray[i] = data[left + i];
          arrayAccesses++;
          $(".swapSpan").html(`No. of array accesses: ${arrayAccesses}`);
          await new Promise((resolve) => setTimeout(resolve, DELAY / 3));
        }
        
        highlightCode("8");
        for (let j = 0; j < rightSize; j++) {
          highlightCode("9");
          rightArray[j] = data[mid + 1 + j];
          arrayAccesses++;
          $(".swapSpan").html(`No. of array accesses: ${arrayAccesses}`);
          await new Promise((resolve) => setTimeout(resolve, DELAY / 3));
        }
        
        // Merge temp arrays back into main array
        highlightCode("10");
        let i = 0, j = 0, k = left;
        
        highlightCode("11");
        while (i < leftSize && j < rightSize) {
          highlightCode("12");
          comparisons++;
          $(".compSpan").text(`No. of comparisons: ${comparisons}`);
          
          if (leftArray[i] <= rightArray[j]) {
            highlightCode("13");
            data[k] = leftArray[i];
            await updateBar(k, leftArray[i], "#FACF5A");  // Highlight the merged element
            i++;
          } else {
            highlightCode("14");
            highlightCode("15");
            data[k] = rightArray[j];
            await updateBar(k, rightArray[j], "#FACF5A");  // Highlight the merged element
            j++;
          }
          k++;
        }
        
        // Copy remaining elements of leftArray[]
        highlightCode("16");
        while (i < leftSize) {
          highlightCode("17");
          data[k] = leftArray[i];
          await updateBar(k, leftArray[i], "#FACF5A");
          i++;
          k++;
        }
        
        // Copy remaining elements of rightArray[]
        highlightCode("18");
        while (j < rightSize) {
          highlightCode("19");
          data[k] = rightArray[j];
          await updateBar(k, rightArray[j], "#FACF5A");
          j++;
          k++;
        }
        
        // Reset colors for this merged segment
        for (let i = left; i <= right; i++) {
          d3.select("#rect" + i).attr("fill", "#CC1616");
        }
      }

      async function mergeSort(left, right) {
        highlightCode("20");
        
        if (left < right) {
          highlightCode("21");
          
          // Find middle point
          highlightCode("22");
          const mid = Math.floor((left + right) / 2);
          await new Promise((resolve) => setTimeout(resolve, DELAY));
          
          // Recursively sort first and second halves
          highlightCode("23");
          await mergeSort(left, mid);
          
          highlightCode("24");
          await mergeSort(mid + 1, right);
          
          // Merge the sorted halves
          highlightCode("25");
          await merge(left, mid, right);
        }
      }

      // Initialize with 15 elements
      newSet(15);
    </script>
  </body>
</html>